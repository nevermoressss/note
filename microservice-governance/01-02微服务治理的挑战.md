## 微服务的挑战
    在微服务深化的过程中，会面临一系列的挑战，这些挑战分为三个大的层面。效率、稳定、成本
我们进⾏微服务化，本身的使命是让业务的迭代更加⾼效，但当我们的微服务数量逐步增多，链路越来越⻓，如果不进⾏进⼀步的治理，那么引发的效率问题可能会⼤于微服务架构本身带 来的架构红利。  
```text
稳定：
    业务高可用、多可用区部署
    同城/异地容灾，业务多活
    微服务需要更加安全、更可信
效率：
    流量高峰期发布
    云边端一体化开发部署联调
    服务治理体系强依赖SDK升级
    k8s下应用IP的不确定，导致服务治理规则的实效
成本：
    迁移成本
    极致、灵活的弹性
```
#### 开发态服务治理 
##### ⽬标是为了提升研发效率，让开发更快捷，主要功能包括
    服务契约：业务开服能够清晰的了解应用定义了哪些接口、每个接口的参数、以及接口的业务说明；便于开发者迅速了解应用。
    服务调试：在微服务开发和运行时快速地对某个接口进行调试，而不需要经过手动编写测试代码，也不需要关心网络打通流程。
    服务 Mock：当某个接口尚未开发完成时，可以通过配置 Mock 此接口的请求行为，返回预 设的值，使得开发时不需要依赖于下游接口开发完成。
    开发环境隔离：通过逻辑隔离的方式，为每一个正在开发的功能特性隔离出一个独立的环境， 在低成本的前提下，划分出多个完整的独立环境，使得各功能特性的开发调试不会互相影响， 提升开发迭代的效率。
    端云互联：本地开发的微服务可以快速的访问云上的服务，云上的服务也能调用到本地开发的微服务。

#### 运⾏态服务治理

##### 发布态
    无损下线
    无损上线
    金丝雀发布
    全链路灰度
##### 安全态
    服务鉴权：保护敏感微服务，确保敏感服务只能被已授权的应用发起访问。
    漏洞防护：开源框架通常会陆陆续续被发现许多漏洞，整体的升级成本很高，需要通过不升级框架的⽅式实现漏洞的防护。
    配置鉴权：某些配置⽐较敏感，不希望任何微服务都有权限访问，控制只有受限的微服务才能访问。
##### 高可用
    限流：针对超过阈值的流量进行限流控制，保障机器和整体业务的稳定性。
    降级：在资源有限的情况下，针对某些不重要的请求返回预设的降级结果，把有限的资源让给重要的请求。
    熔断：客户端访问后端服务不可用的情况下，返回固定异常或预定义的结果，避免引起业务异常，甚至雪崩。
    离群实例摘除：在单个服务提供者节点持续不可用的情况下，在消费者侧摘除这个异常节点，保障业务的高可用。
    同可用区优先路由：微服务多可用区部署的情况下，确保流量优先在同一个可用区内流转，降低业务的整体时延。
    就近容灾路由：当某个可⽤区发⽣故障，可以把流量尽快的切到正常的可⽤区，让业务以最快速度恢复。

#### 微服务全链路灰度解决方案
    蓝绿发布
    灰度发布
    全链路灰度

##### 全链路灰度
##### #物理环境隔离
    通过增加机器的⽅式来搭建真正意义上的流量隔离。
    这种⽅案需要为要灰度的服务搭建⼀套⽹络隔离、资源独⽴的环境，在其中部署服务的灰度版 本。由于与正式环境隔离，正式环境中的其他服务⽆法访问到需要灰度的服务，所以需要在灰 度环境中冗余部署这些线上服务，以便整个调⽤链路正常进⾏流量转发。此外，注册中⼼等⼀ 些其他依赖的中间件组件也 需要冗余部署在灰度环境中，保证微服务之间的可⻅性问题，确保 获取的节点 IP 地址只属于当前的⽹络环境。
##### #逻辑环境隔离
    只需部署服务的灰度版本，流量在调⽤链路上流转时，由流经的⽹关、各个中间件以及各个微服务来识别灰度流量，并动态转发⾄对应服务的灰 度版本。
    无论是微服务网关还是微服务本身都需要识别流量，根据治理规则做出动态决策。
##### #全链路灰度需要解决的问题
    1.链路上各个组件和服务能够根据请求流量特征进⾏动态路由。
    2.需要对服务下的所有节点进⾏分组，能够区分版本。
    3.需要对流量进⾏灰度标识、版本标识。
    4.需要识别出不同版本的灰度流量。
